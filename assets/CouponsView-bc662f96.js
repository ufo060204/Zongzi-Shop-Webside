import{M as b}from"./modal-2c40c655.js";import{S as a}from"./sweetalert2.all-4b4f968c.js";import{_ as M,c as l,d as y,b as o,F as C,q as w,s as L,H as u,I as r,M as x,t as p,h as f,r as k,o as d}from"./index-74925d86.js";const{VITE_APP_URL:h,VITE_APP_PATH:_}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"ufo060204",BASE_URL:"/Zongzi-Shop-Webside/",MODE:"production",DEV:!1,PROD:!0},V={data(){return{coupons:{},due_date:"",tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1,color:"#FF700C",couponModal:"",delCouponModal:""}},watch:{due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{getCoupon(){this.isLoading=!0;const n=`${h}api/${_}/admin/coupons`;this.$http.get(n,this.tempCoupon).then(t=>{this.coupons=t.data.coupons,this.isLoading=!1}).catch(t=>{this.isLoading=!1,a.fire(t.response)})},openCouponModal(n,t){this.isNew=n,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...t},this.couponModal.show()},openDelCouponModal(n){this.tempCoupon={...n},this.delCouponModal.show()},updateCoupon(){this.isLoading=!0;let n=`${h}api/${_}/admin/coupon`,t="post",m=this.tempCoupon;this.isNew||(n=`${h}api/${_}/admin/coupon/${this.tempCoupon.id}`,t="put",m=this.tempCoupon),this.$http[t](n,{data:m}).then(c=>{this.isLoading=!1,this.getCoupon(),this.couponModal.hide(),a.fire(c.data.message)}).catch(c=>{this.isLoading=!1,a.fire(c.response)})},dateFilter(n){return new Date(n*1e3).toLocaleDateString()},delCoupon(){this.isLoading=!0;const n=`${h}api/${_}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(n).then(t=>{this.isLoading=!1,this.getCoupon(),this.delCouponModal.hide(),a.fire(t.data.message)}).catch(t=>{this.isLoading=!1,a.fire(t.response)})}},mounted(){this.getCoupon(),this.couponModal=new b(this.$refs.couponModal),this.delCouponModal=new b(this.$refs.delCouponModal)}},D={class:"container-lg"},P={class:"text-end mt-4"},N={class:"table mt-4 table-responsive"},T=o("thead",null,[o("tr",null,[o("th",{width:"120"},"名稱"),o("th",{width:"120"},"折扣百分比例"),o("th",{width:"120"},"到期日"),o("th",{width:"100"},"是否啟用"),o("th",{width:"120"},"編輯")])],-1),E={key:0,class:"text-success"},U={key:1,class:"text-muted"},A={class:"btn-group"},S=["onClick"],F=["onClick"],q={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},I={class:"modal-dialog modal-xl"},B={class:"modal-header bg-dark text-white"},R={id:"productModalLabel",class:"modal-title"},H={key:0},z={key:1},O=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),W={class:"modal-body"},Z={class:"mb-3"},j=o("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=o("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=o("label",{for:"due_date"},"期限",-1),X={class:"mb-3"},Y=o("label",{for:"price"},"折扣百分比例",-1),$={class:"mb-3"},oo={class:"form-check"},to=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),eo={class:"modal-footer"},so=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),no={type:"submit",class:"btn btn-primary"},lo={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},io={class:"modal-dialog"},ao={class:"modal-content border-0"},uo=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delCouponModalLabel",class:"modal-title"},[o("span",null,"刪除優惠券")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),po={class:"modal-body"},co=o("strong",{class:"text-danger"},null,-1),ro={class:"modal-footer"},ho=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function _o(n,t,m,c,e,i){const g=k("VueLoading");return d(),l(C,null,[y(g,{active:e.isLoading,color:e.color,"z-index":9999},null,8,["active","color"]),o("div",D,[o("div",P,[o("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=()=>i.openCouponModal(!0))}," 建立新的優惠券 ")]),o("table",N,[T,o("tbody",null,[(d(!0),l(C,null,w(e.coupons,(s,v)=>(d(),l("tr",{key:v},[o("td",null,p(s.title),1),o("td",null,p(s.percent),1),o("td",null,p(i.dateFilter(s.due_date)),1),o("td",null,[s.is_enabled===1?(d(),l("span",E,"啟用")):(d(),l("span",U,"未啟用"))]),o("td",null,[o("div",A,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>i.openCouponModal(!1,s)}," 編輯 ",8,S),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>i.openDelCouponModal(s)}," 刪除 ",8,F)])])]))),128))])]),o("div",q,[o("div",I,[o("form",{onSubmit:t[6]||(t[6]=L(s=>i.updateCoupon(e.tempCoupon),["prevent"])),class:"modal-content border-0"},[o("div",B,[o("h5",R,[e.isNew?(d(),l("span",H,"新增優惠券")):(d(),l("span",z,"編輯優惠券"))]),O]),o("div",W,[o("div",Z,[j,u(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=s=>e.tempCoupon.title=s),placeholder:"請輸入標題",required:""},null,512),[[r,e.tempCoupon.title]])]),o("div",G,[J,u(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[2]||(t[2]=s=>e.tempCoupon.code=s),placeholder:"請輸入優惠碼",required:""},null,512),[[r,e.tempCoupon.code]])]),o("div",K,[Q,u(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[3]||(t[3]=s=>e.due_date=s),required:""},null,512),[[r,e.due_date]])]),o("div",X,[Y,u(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[4]||(t[4]=s=>e.tempCoupon.percent=s),placeholder:"請輸入折扣百分比",required:""},null,512),[[r,e.tempCoupon.percent]])]),o("div",$,[o("div",oo,[u(o("input",{type:"checkbox","true-value":1,"false-value":0,class:"form-check-input",id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=s=>e.tempCoupon.is_enabled=s)},null,512),[[x,e.tempCoupon.is_enabled]]),to])])]),o("div",eo,[so,o("button",no,p(e.isNew?"新增優惠券":"更新優惠券"),1)])],32)])],512),o("div",lo,[o("div",io,[o("div",ao,[uo,o("div",po,[f(" 是否刪除 "),co,f(" "+p(e.tempCoupon.title)+" (刪除後將無法恢復)。 ",1)]),o("div",ro,[ho,o("button",{type:"button",class:"btn btn-danger",onClick:t[7]||(t[7]=()=>i.delCoupon())}," 確認刪除 ")])])])],512)])],64)}const fo=M(V,[["render",_o]]);export{fo as default};
